<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cybersecurity Analysis Toolkit</title>
    <style>
        /* Basic reset and body styling */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        /* Container for the entire application */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        /* Header styling */
        .header {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        /* Grid layout for tool cards */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 30px;
        }
        
        /* Styling for individual tool cards */
        .tool-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .tool-card h3 {
            color: #2a5298;
            margin-bottom: 15px;
            font-size: 1.4em;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        /* Input group styling */
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }
        
        /* Button styling */
        .btn {
            background: linear-gradient(45deg, #2a5298, #1e3c72);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(42, 82, 152, 0.3);
        }
        
        /* Result area styling */
        .result-area {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #2a5298;
            display: none; /* Hidden by default */
        }
        
        .result-area.show {
            display: block; /* Shown when 'show' class is added */
        }
        
        /* Risk level specific styling for result areas */
        .risk-high { border-left-color: #dc3545; background-color: #f8d7da; }
        .risk-medium { border-left-color: #ffc107; background-color: #fff3cd; }
        .risk-low { border-left-color: #28a745; background-color: #d4edda; }
        
        /* Loading indicator styling */
        .loading {
            display: none; /* Hidden by default */
            text-align: center;
            color: #666;
            margin: 20px 0;
        }
        
        .loading.show {
            display: block; /* Shown when 'show' class is added */
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2a5298;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Feature list styling */
        .feature-list {
            list-style: none;
            margin: 15px 0;
        }
        
        .feature-list li {
            padding: 5px 0;
            color: #666;
        }
        
        .feature-list li:before {
            content: "‚úì";
            color: #28a745;
            font-weight: bold;
            margin-right: 8px;
        }

        /* NEW: Styling for lists within result areas to make bullets appear "inside the box" */
        .result-area ul {
            list-style-type: disc; /* Ensure standard disc bullets */
            padding-left: 25px; /* Add padding to push bullets inside */
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .result-area ul li {
            padding: 3px 0; /* Adjust padding for list items */
            color: #444; /* Slightly darker text for readability */
        }

        /* Remove the checkmark for lists within results, as they are not feature lists */
        .result-area ul li:before {
            content: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è Cybersecurity Analysis Toolkit</h1>
            <p>Comprehensive security analysis tools for threat detection and investigation</p>
        </div>
        
        <div class="tools-grid">
            <!-- Phishing Email Detector -->
            <div class="tool-card">
                <h3>üìß Phishing Email Detector</h3>
                <p>Analyze email content for phishing indicators using ML and heuristics.</p>
                <ul class="feature-list">
                    <li>Suspicious keyword detection</li>
                    <li>URL analysis</li>
                    <li>Pattern matching</li>
                    <li>Risk scoring</li>
                </ul>
                <div class="input-group">
                    <label for="email-content">Email Content:</label>
                    <textarea id="email-content" rows="4" placeholder="Paste email content here..."></textarea>
                </div>
                <div class="input-group">
                    <label for="sender-email">Sender Email (optional):</label>
                    <input type="email" id="sender-email" placeholder="sender@example.com">
                </div>
                <button class="btn" onclick="analyzeEmail()">Analyze Email</button>
                <div class="loading" id="email-loading">
                    <div class="spinner"></div>
                    Analyzing email for phishing indicators...
                </div>
                <div class="result-area" id="email-result"></div>
            </div>
            
            <!-- GeoIP Locator -->
            <div class="tool-card">
                <h3>üåç GeoIP Locator</h3>
                <p>Get detailed location and threat intelligence for any IP address.</p>
                <ul class="feature-list">
                    <li>Geographic location</li>
                    <li>ISP and organization info</li>
                    <li>Threat intelligence</li>
                    <li>Network details</li>
                </ul>
                <div class="input-group">
                    <label for="ip-address">IP Address:</label>
                    <input type="text" id="ip-address" placeholder="8.8.8.8">
                </div>
                <button class="btn" onclick="analyzeIP()">Locate IP</button>
                <div class="loading" id="ip-loading">
                    <div class="spinner"></div>
                    Fetching IP geolocation data...
                </div>
                <div class="result-area" id="ip-result"></div>
            </div>
            
            <!-- URL Scanner -->
            <div class="tool-card">
                <h3>üîó Malicious URL Scanner</h3>
                <p>Scan URLs for malicious content using multiple detection engines.</p>
                <ul class="feature-list">
                    <li>VirusTotal integration</li>
                    <li>Heuristic analysis</li>
                    <li>Reputation checking</li>
                    <li>Risk assessment</li>
                </ul>
                <div class="input-group">
                    <label for="url-input">URL to Scan:</label>
                    <input type="url" id="url-input" placeholder="https://example.com">
                </div>
                <button class="btn" onclick="scanURL()">Scan URL</button>
                <div class="loading" id="url-loading">
                    <div class="spinner"></div>
                    Scanning URL for threats...
                </div>
                <div class="result-area" id="url-result"></div>
            </div>
            
            <!-- Email Header Analyzer -->
            <div class="tool-card">
                <h3>üìã Email Header Analyzer</h3>
                <p>Analyze email headers for authentication and security indicators.</p>
                <ul class="feature-list">
                    <li>SPF/DKIM/DMARC verification</li>
                    <li>Routing path analysis</li>
                    <li>Security indicators</li>
                    <li>Spoofing detection</li>
                </ul>
                <div class="input-group">
                    <label for="email-headers">Email Headers:</label>
                    <textarea id="email-headers" rows="6" placeholder="Paste full email headers here..."></textarea>
                </div>
                <button class="btn" onclick="analyzeHeaders()">Analyze Headers</button>
                <div class="loading" id="headers-loading">
                    <div class="spinner"></div>
                    Analyzing email headers...
                </div>
                <div class="result-area" id="headers-result"></div>
            </div>
        </div>
    </div>

    <script>
        // Helper functions for UI feedback
        function showLoading(loadingId) {
            document.getElementById(loadingId).classList.add('show');
        }
        
        function hideLoading(loadingId) {
            document.getElementById(loadingId).classList.remove('show');
        }
        
        function showResult(resultId, content, riskLevel = 'low') {
            const resultDiv = document.getElementById(resultId);
            resultDiv.innerHTML = content;
            // Remove previous risk classes and add the new one
            resultDiv.classList.remove('risk-high', 'risk-medium', 'risk-low');
            resultDiv.classList.add('show', `risk-${riskLevel}`);
        }

        // Custom message box function to replace alert()
        function showMessageBox(message, type = 'info') {
            const messageBox = document.createElement('div');
            messageBox.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: ${type === 'error' ? '#f8d7da' : '#d4edda'};
                color: ${type === 'error' ? '#721c24' : '#155724'};
                border: 1px solid ${type === 'error' ? '#f5c6cb' : '#c3e6cb'};
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                z-index: 1000;
                font-size: 1.1em;
                text-align: center;
                min-width: 300px;
                max-width: 80%;
            `;
            messageBox.innerHTML = `<strong>${type.toUpperCase()}:</strong> ${message}`;
            document.body.appendChild(messageBox);

            setTimeout(() => {
                messageBox.remove();
            }, 3000); // Message disappears after 3 seconds
        }
        
        async function analyzeEmail() {
            const content = document.getElementById('email-content').value;
            // const sender = document.getElementById('sender-email').value; // This field is not used by the backend currently
            
            if (!content.trim()) {
                showMessageBox('Please enter email content to analyze', 'error');
                return;
            }
            
            showLoading('email-loading');
            
            try {
                const response = await fetch('http://127.0.0.1:5000/analyze_email', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: content })
                });

                const data = await response.json();
                hideLoading('email-loading');

                if (data.error) {
                    showResult('email-result', `<p><strong>Error:</strong> ${data.error}</p>`, 'high');
                    return;
                }

                // Determine risk level based on backend's risk_assessment or security_indicators
                let riskLevel = 'low';
                if (data.risk_assessment && data.risk_assessment.toLowerCase().includes('high')) {
                    riskLevel = 'high';
                } else if (data.risk_assessment && data.risk_assessment.toLowerCase().includes('medium')) {
                    riskLevel = 'medium';
                } else if (data.security_indicators && data.security_indicators.length > 0) {
                    // If there are security indicators, it's at least medium risk
                    riskLevel = 'medium'; 
                }

                const authStatus = data.authentication.authentication_status || 'Unknown';
                const spfResult = data.authentication.spf_result || 'N/A';
                const dkimResult = data.authentication.dkim_result || 'N/A';
                const dmarcResult = data.authentication.dmarc_result || 'N/A';

                let securityIndicatorsHtml = '';
                if (data.security_indicators && data.security_indicators.length > 0) {
                    securityIndicatorsHtml = `
                        <h5>üö® Security Indicators:</h5>
                        <ul>
                            ${data.security_indicators.map(indicator => `<li>${indicator}</li>`).join('')}
                        </ul>
                    `;
                } else {
                    securityIndicatorsHtml = '<p>‚úÖ No explicit security indicators found.</p>';
                }

                const result = `
                    <h4>üìä Email Analysis Results</h4>
                    <p><strong>Overall Risk:</strong> ${data.risk_assessment || 'N/A'}</p>
                    <p><strong>Analysis Summary:</strong> ${data.summary || 'No summary provided.'}</p>
                    
                    <h5>üì® Sender Information:</h5>
                    <p><strong>From:</strong> ${data.sender_info.from_address || 'N/A'}</p>
                    <p><strong>Reply-To:</strong> ${data.sender_info.reply_to_address || 'N/A'}</p>
                    <p><strong>Return-Path:</strong> ${data.sender_info.return_path || 'N/A'}</p>

                    <h5>üîê Authentication Results:</h5>
                    <ul>
                        <li><strong>Overall Status:</strong> ${authStatus}</li>
                        <li><strong>SPF:</strong> ${spfResult}</li>
                        <li><strong>DKIM:</strong> ${dkimResult}</li>
                        <li><strong>DMARC:</strong> ${dmarcResult}</li>
                    </ul>
                    
                    <h5>‚û°Ô∏è Routing Path:</h5>
                    <ul>
                        ${data.routing_path && data.routing_path.length > 0 ?
                            data.routing_path.map(hop => `<li>${hop.received_from} (${hop.by_server}) - ${hop.delay}</li>`).join('') :
                            '<li>No detailed routing path available.</li>'
                        }
                    </ul>

                    ${securityIndicatorsHtml}

                    <div style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                        <strong>üéØ Recommendation:</strong> ${data.risk_assessment && data.risk_assessment.toLowerCase().includes('high') ? 
                            'This email is highly suspicious. Do not interact with it, delete it, and report it if possible.' : 
                            'Review the details carefully. If anything seems off, proceed with caution.'}
                    </div>
                `;
                
                showResult('email-result', result, riskLevel);

            } catch (err) {
                hideLoading('email-loading');
                showResult('email-result', `<p><strong>Error:</strong> Failed to connect to backend or parse response: ${err.message}</p>`, 'high');
            }
        }
        
        async function analyzeIP() {
            const ip = document.getElementById('ip-address').value.trim();
            if (!ip) {
                showMessageBox("Please enter an IP address", 'error');
                return;
            }

            showLoading('ip-loading');

            try {
                const response = await fetch('http://127.0.0.1:5000/analyze_ip', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ip })
                });

                const data = await response.json();
                hideLoading('ip-loading');

                if (response.status !== 200) { // Check for non-200 responses
                    showResult('ip-result', `<p><strong>Error:</strong> ${data.error || 'Unknown error'}</p>`, 'high');
                    return;
                }

                const result = `
                    <h4>üåç GeoIP Analysis Results</h4>
                    <p><strong>IP Address:</strong> ${data.ip}</p>
                    <p><strong>Location:</strong> ${data.city}, ${data.region}, ${data.country}</p>
                    <p><strong>ISP:</strong> ${data.isp}</p>
                    <p><strong>Organization:</strong> ${data.organization}</p>
                    <p><strong>ASN:</strong> ${data.asn}</p>
                    <p><strong>Threat Level:</strong> ${data.threat_level}</p>
                    <p><strong>Proxy/VPN:</strong> ${data.is_proxy ? 'Yes' : 'No'}</p>
                    <p><strong>Tor Exit Node:</strong> ${data.is_tor ? 'Yes' : 'No'}</p>
                    <div style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 5px;">
                        <strong>üìç Coordinates:</strong> ${data.latitude}, ${data.longitude}<br>
                        <strong>üïê Timezone:</strong> ${data.timezone}
                    </div>
                `;

                let risk = 'low';
                if (data.threat_level === 'HIGH') risk = 'high';
                else if (data.threat_level === 'MEDIUM') risk = 'medium';

                showResult('ip-result', result, risk);

            } catch (err) {
                hideLoading('ip-loading');
                showResult('ip-result', `<p><strong>Error:</strong> Failed to connect to backend or parse response: ${err.message}</p>`, 'high');
            }
        }

        async function scanURL() {
            const url = document.getElementById('url-input').value.trim();
            
            if (!url) {
                showMessageBox('Please enter a URL to scan', 'error');
                return;
            }
            
            showLoading('url-loading');
            
            try {
                // Make the actual API call to your Flask backend
                const response = await fetch('http://127.0.0.1:5000/analyze_url', { // Changed to /analyze_url
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url: url })
                });
                
                const data = await response.json();
                hideLoading('url-loading');
                
                if (response.status !== 200) { // Check for non-200 responses
                    showResult('url-result', `<p><strong>Error:</strong> ${data.error || 'Unknown error'}</p>`, 'high');
                    return;
                }
                
                // Determine risk level based on score
                let riskLevel = 'low';
                if (data.risk_score >= 7) {
                    riskLevel = 'high';
                } else if (data.risk_score >= 4) {
                    riskLevel = 'medium';
                }
                
                // Build detections list
                let detectionsHtml = '';
                if (data.detections && Object.keys(data.detections).length > 0) {
                    detectionsHtml = '<h5>Detections:</h5><ul>';
                    for (const [source, detection] of Object.entries(data.detections)) {
                        detectionsHtml += `<li><strong>${source}:</strong> ${detection}</li>`;
                    }
                    detectionsHtml += '</ul>';
                } else {
                    detectionsHtml = '<p>‚úÖ No specific detections reported.</p>';
                }
                
                // Build heuristic indicators list
                let heuristicIndicatorsHtml = '';
                if (data.additional_info && data.additional_info.heuristic_indicators && data.additional_info.heuristic_indicators.length > 0) {
                    heuristicIndicatorsHtml = '<h5>‚ö†Ô∏è Heuristic Indicators:</h5><ul>';
                    for (const indicator of data.additional_info.heuristic_indicators) {
                        heuristicIndicatorsHtml += `<li>${indicator}</li>`;
                    }
                    heuristicIndicatorsHtml += '</ul>';
                } else {
                    heuristicIndicatorsHtml = '<p>‚úÖ No heuristic indicators found.</p>';
                }
                
                // Build VirusTotal info
                let vtHtml = '';
                if (data.additional_info && data.additional_info.virustotal) {
                    const vt = data.additional_info.virustotal;
                    vtHtml = `
                        <h5>üîç VirusTotal Summary:</h5>
                        <ul>
                            <li><strong>Malicious Detections:</strong> ${vt.malicious || 0}</li>
                            <li><strong>Suspicious Detections:</strong> ${vt.suspicious || 0}</li>
                            <li><strong>Harmless Detections:</strong> ${vt.harmless || 0}</li>
                            <li><strong>Total Engines Scanned:</strong> ${vt.total_scans || 0}</li>
                        </ul>
                    `;
                } else {
                    vtHtml = '<p>‚ÑπÔ∏è No VirusTotal data available.</p>';
                }
                
                const result = `
                    <h4>üîç URL Scan Results</h4>
                    <p><strong>URL:</strong> ${data.url}</p>
                    <p><strong>Status:</strong> ${data.is_malicious ? '‚ö†Ô∏è MALICIOUS' : '‚úÖ CLEAN'}</p>
                    <p><strong>Risk Score:</strong> ${data.risk_score}/10</p>
                    <p><strong>Categories:</strong> ${data.categories && data.categories.length > 0 ? data.categories.join(', ') : 'N/A'}</p>
                    <p><strong>Scan Date:</strong> ${data.scan_date || 'N/A'}</p>
                    
                    ${detectionsHtml}
                    ${heuristicIndicatorsHtml}
                    ${vtHtml}
                    
                    <div style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                        <strong>üéØ Recommendation:</strong> ${data.is_malicious ? 
                            'This URL appears to be malicious. Do not visit or interact with it.' : 
                            'This URL appears to be clean, but always exercise caution when clicking links.'}
                    </div>
                `;
                
                showResult('url-result', result, riskLevel);
                
            } catch (error) {
                hideLoading('url-loading');
                showResult('url-result', `<p><strong>Error:</strong> Failed to connect to backend or parse response: ${error.message}</p>`, 'high');
            }
        }
        
        async function analyzeHeaders() {
            const headers = document.getElementById('email-headers').value;
            
            if (!headers.trim()) {
                showMessageBox('Please enter email headers to analyze', 'error');
                return;
            }
            
            showLoading('headers-loading');
            
            try {
                const response = await fetch('http://127.0.0.1:5000/analyze_email', { // Assuming analyze_email handles headers
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: headers }) // Send headers as 'email' content
                });

                const data = await response.json();
                hideLoading('headers-loading');

                if (response.status !== 200) { // Check for non-200 responses
                    showResult('headers-result', `<p><strong>Error:</strong> ${data.error || 'Unknown error'}</p>`, 'high');
                    return;
                }

                // Determine risk level based on backend's risk_assessment
                let riskLevel = 'low';
                if (data.risk_assessment && data.risk_assessment.toLowerCase().includes('high')) {
                    riskLevel = 'high';
                } else if (data.risk_assessment && data.risk_assessment.toLowerCase().includes('medium')) {
                    riskLevel = 'medium';
                }

                // Format authentication results
                const authResultsHtml = `
                    <ul>
                        <li><strong>SPF:</strong> ${data.authentication.spf_result || 'N/A'}</li>
                        <li><strong>DKIM:</strong> ${data.authentication.dkim_result || 'N/A'}</li>
                        <li><strong>DMARC:</strong> ${data.authentication.dmarc_result || 'N/A'}</li>
                        <li><strong>Overall Status:</strong> ${data.authentication.authentication_status || 'N/A'}</li>
                    </ul>
                `;

                // Format routing path
                let routingPathHtml = '';
                if (data.routing_path && data.routing_path.length > 0) {
                    routingPathHtml = '<h5>‚û°Ô∏è Routing Path:</h5><ul>';
                    data.routing_path.forEach(hop => {
                        routingPathHtml += `<li>From: ${hop.received_from || 'N/A'} | By: ${hop.by_server || 'N/A'} | Delay: ${hop.delay || 'N/A'}</li>`;
                    });
                    routingPathHtml += '</ul>';
                } else {
                    routingPathHtml = '<p>No detailed routing path available.</p>';
                }

                // Format security indicators
                let securityIndicatorsHtml = '';
                if (data.security_indicators && data.security_indicators.length > 0) {
                    securityIndicatorsHtml = '<h5>üö® Security Indicators:</h5><ul>';
                    data.security_indicators.forEach(indicator => {
                        securityIndicatorsHtml += `<li>${indicator}</li>`;
                    });
                    securityIndicatorsHtml += '</ul>';
                } else {
                    securityIndicatorsHtml = '<p>No specific security indicators found.</p>';
                }

                const result = `
                    <h4>üìã Email Header Analysis</h4>
                    <p><strong>Overall Risk Assessment:</strong> ${data.risk_assessment || 'N/A'}</p>
                    <p><strong>Analysis Summary:</strong> ${data.analysis_summary || 'N/A'}</p>
                    
                    <h5>üîê Authentication Results:</h5>
                    ${authResultsHtml}
                    
                    <h5>üì® Sender Information:</h5>
                    <p><strong>From Address:</strong> ${data.sender_info.from_address || 'N/A'}</p>
                    <p><strong>Reply-To Address:</strong> ${data.sender_info.reply_to_address || 'N/A'}</p>
                    <p><strong>Return Path:</strong> ${data.sender_info.return_path || 'N/A'}</p>
                    
                    ${routingPathHtml}
                    ${securityIndicatorsHtml}

                    <div style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                        <strong>üéØ Recommendation:</strong> ${riskLevel === 'high' ? 
                            'This email has significant header red flags. Treat with extreme suspicion and do not interact.' : 
                            'Headers appear clean, but always verify sender and content before interacting.'}
                    </div>
                `;
                
                showResult('headers-result', result, riskLevel);

            } catch (err) {
                hideLoading('headers-loading');
                showResult('headers-result', `<p><strong>Error:</strong> Failed to connect to backend or parse response: ${err.message}</p>`, 'high');
            }
        }

        // Utility function to extract "From" domain from headers (kept for completeness, though backend handles this)
        function extractFromDomain(headers) {
            const match = headers.match(/From:\s?.*?@([^\s>]+)/i);
            if (match && match[1]) {
                return match[1].trim();
            }
            return 'Unknown';
        }
    </script>
</body>
</html>
